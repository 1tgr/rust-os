include_rules

ISO += ../kernel/kernel
ISO += initrd.tar.gz
ISO += menu.lst
ISO += stage2_eltorito

INITRD += ../apps/cairo_demo/cairo_demo
INITRD += ../apps/graphics_client/graphics_client
INITRD += ../apps/graphics_server/graphics_server
INITRD += ../apps/hello/hello

: $(INITRD) |> tar --transform 's/.*\///g' -cf %o %f |> initrd.tar
: initrd.tar |> gzip -k %f |> initrd.tar.gz

: $(ISO) |> cp stage2_eltorito stage2_eltorito_temp && genisoimage -R -b boot/grub/stage2_eltorito -no-emul-boot -boot-load-size 4 -boot-info-table -graft-points -o %o kernel=../kernel/kernel initrd.tar.gz boot/grub/menu.lst=menu.lst boot/grub/stage2_eltorito=stage2_eltorito_temp && rm stage2_eltorito_temp |> bootable.iso
